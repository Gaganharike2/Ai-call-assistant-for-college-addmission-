<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Register | BFGI Admission Portal</title>

<link rel="stylesheet" href="{{ url_for('static', filename='css3/styles.css') }}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>

/* ================= BACKGROUND ================= */

body{
  background:linear-gradient(135deg,#4f46e5,#06b6d4);
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:Arial, sans-serif;
}

/* ================= CARD ================= */

.card{
  width:450px;
  background:white;
  padding:35px;
  border-radius:18px;
  box-shadow:0 25px 50px rgba(0,0,0,.3);
}

/* ================= HEADING ================= */

.card h2{
  text-align:center;
  margin-bottom:8px;
}

.sub{
  text-align:center;
  font-size:14px;
  color:#666;
  margin-bottom:22px;
}

/* ================= INPUT ================= */

.input-box{
  position:relative;
  margin-bottom:15px;
}

.input-box i{
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  color:#666;
}

.input-box input,
select{
  width:100%;
  padding:12px 12px 12px 38px;
  border:1px solid #ccc;
  border-radius:8px;
  font-size:15px;
}

select{
  padding-left:12px;
}

/* ================= BUTTON ================= */

button{
  width:100%;
  padding:12px;
  background:#4f46e5;
  border:none;
  border-radius:8px;
  color:white;
  font-size:16px;
  cursor:pointer;
  margin-top:5px;
}

button:hover{ opacity:.9; }
button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

/* ================= LINKS ================= */

.links{
  text-align:center;
  margin-top:16px;
}

.links a{
  color:#4f46e5;
  text-decoration:none;
}

.links a:hover{
  text-decoration:underline;
}

/* ================= LOADER ================= */

.loader{
  width:22px;
  height:22px;
  border:3px solid #4f46e5;
  border-top:3px solid transparent;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:10px auto 0;
  display:none;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

/* ================= TOAST ================= */

.toast{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#111;
  color:#fff;
  padding:12px 20px;
  border-radius:8px;
  display:none;
}

</style>
</head>

<body>

<div class="card">

<h2>üìù Create Account</h2>

<div class="sub">
  Register for BFGI Admission Portal
</div>

<form id="form">

<!-- Name -->
<div class="input-box">
  <i class="fa-solid fa-user"></i>
  <input id="name" placeholder="Full Name" required>
</div>

<!-- Username -->
<div class="input-box">
  <i class="fa-solid fa-user-tag"></i>
  <input id="username" placeholder="Username" required>
</div>

<!-- Email -->
<div class="input-box">
  <i class="fa-solid fa-envelope"></i>
  <input id="email" type="email" placeholder="Email" required>
</div>

<!-- Mobile -->
<div class="input-box">
  <i class="fa-solid fa-phone"></i>
  <input id="mobile" placeholder="Mobile Number" required pattern="[0-9]{10}">
</div>

<!-- Password -->
<div class="input-box">
  <i class="fa-solid fa-lock"></i>
  <input id="pass1" type="password" placeholder="Password" minlength="6" required>
</div>

<!-- Confirm -->
<div class="input-box">
  <i class="fa-solid fa-lock"></i>
  <input id="pass2" type="password" placeholder="Confirm Password" minlength="6" required>
</div>

<!-- Role -->
<select id="role" required>
  <option value="">Select Role</option>
  <option value="Student">Student</option>
  <option value="Staff">Staff</option>
  <option value="Admin">Admin</option>
</select>

<button type="submit" id="btn">Create Account</button>

<div class="loader" id="loader"></div>

</form>

<div class="links">
  Already have an account?
  <a href="{{ url_for('login_page') }}">Login</a>
</div>

</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>

const form = document.getElementById("form");
const toast = document.getElementById("toast");
const btn = document.getElementById("btn");
const loader = document.getElementById("loader");

/* REGISTER */
form.onsubmit = async e => {

  e.preventDefault();

  if(pass1.value !== pass2.value){
    showToast("Passwords do not match ‚ùå");
    return;
  }

  btn.disabled = true;
  loader.style.display = "block";

  try{

    const r = await fetch("{{ url_for('register_api') }}", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        name:name.value.trim(),
        username:username.value.trim(),
        email:email.value.trim(),
        mobile:mobile.value.trim(),
        password:pass1.value,
        role:role.value
      })
    });

    const d = await r.json();

    if(d.status === "success"){
      showToast("Account created ‚úî");
      setTimeout(()=>{
        location.href="{{ url_for('login_page') }}";
      },1200);
    }else{
      showToast(d.message || "Registration failed ‚ùå");
    }

  }catch{
    showToast("Server error ‚ùå");
  }

  btn.disabled = false;
  loader.style.display = "none";
};

/* UTIL */
function showToast(text){
  toast.textContent = text;
  toast.style.display="block";
  setTimeout(()=>toast.style.display="none",2500);
}

</script>

</body>
</html>
