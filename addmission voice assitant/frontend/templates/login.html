<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Login | BFGI Admission Portal</title>

<link rel="stylesheet" href="{{ url_for('static', filename='css3/styles.css') }}">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>

/* ================= VIDEO BACKGROUND ================= */

video{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:-3;
}

.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  z-index:-2;
}


/* ================= LOGIN ================= */

.container{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.card{
  width:420px;
  padding:35px;
  border-radius:18px;
  background:rgba(255,255,255,.12);
  backdrop-filter:blur(15px);
  box-shadow:0 30px 60px rgba(0,0,0,.4);
  color:white;
}

/* Headings */
.card h2{
  text-align:center;
  margin-bottom:6px;
}

.welcome{
  text-align:center;
  font-size:14px;
  opacity:.9;
  margin-bottom:22px;
}

/* Input Group */
.input-box{
  position:relative;
  margin-bottom:15px;
}

.input-box i{
  position:absolute;
  left:12px;
  top:50%;
  transform:translateY(-50%);
  color:#ddd;
}

.input-box input{
  width:100%;
  padding:12px 12px 12px 38px;
  background:rgba(255,255,255,.15);
  border:none;
  border-radius:8px;
  color:white;
}

.input-box input::placeholder{
  color:#ddd;
}

/* Options */
.opts{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:14px;
  margin-bottom:12px;
}

.opts a{
  color:#60a5fa;
  text-decoration:none;
}

.opts a:hover{
  text-decoration:underline;
}

/* Checkbox */
.check{
  display:flex;
  align-items:center;
  gap:6px;
  font-size:14px;
  margin-bottom:12px;
}

/* Buttons */
button{
  width:100%;
  padding:12px;
  background:linear-gradient(45deg,#4f46e5,#06b6d4);
  border:none;
  border-radius:8px;
  color:white;
  font-size:16px;
  cursor:pointer;
  margin-top:8px;
}

button:hover{ opacity:.9; }
button:disabled{ opacity:.6; cursor:not-allowed; }

/* Voice Button */
.voice-btn{
  background:linear-gradient(45deg,#6366f1,#0ea5e9);
}

/* Footer Links */
.footer-links{
  text-align:center;
  margin-top:16px;
  font-size:14px;
}

.footer-links a{
  color:#60a5fa;
  text-decoration:none;
}

.footer-links a:hover{
  text-decoration:underline;
}

/* Loader */
.loader{
  width:22px;
  height:22px;
  border:3px solid white;
  border-top:3px solid transparent;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:10px auto 0;
  display:none;
}

@keyframes spin{
  to{transform:rotate(360deg)}
}

/* Toast */
.toast{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#111;
  color:#fff;
  padding:12px 20px;
  border-radius:8px;
  display:none;
}

</style>
</head>

<body>

<!-- VIDEO -->
<video autoplay muted loop playsinline>
  <source src="{{ url_for('static', filename='videos/login-bg.mp4') }}">
</video>

<div class="overlay"></div>

<!-- LOGIN -->
<div class="container">
<div class="card">

<h2>üîê Secure Login</h2>

<div class="welcome">
  Welcome back to <strong>BFGI Admission Portal</strong> üëã
</div>

<form id="form">

<!-- Username -->
<div class="input-box">
  <i class="fa-solid fa-user"></i>
  <input id="user" placeholder="Username" required autocomplete="username">
</div>

<!-- Password -->
<div class="input-box">
  <i class="fa-solid fa-lock"></i>
  <input id="pass" type="password" placeholder="Password" required autocomplete="current-password">
</div>

<!-- Options -->
<div class="opts">
  <label class="check">
    <input type="checkbox" onclick="showPass()"> Show Password
  </label>

  <a href="#" onclick="forgot()">Forgot?</a>
</div>

<!-- Remember -->
<label class="check">
  <input type="checkbox" id="remember"> Remember this device
</label>

<!-- Login -->
<button type="submit" id="btn">
  <i class="fa-solid fa-right-to-bracket"></i> Login
</button>

<div class="loader" id="loader"></div>

</form>

<!-- Voice Login -->
<button class="voice-btn" onclick="voiceLogin()">
  <i class="fa-solid fa-microphone"></i> Voice Login
</button>

<!-- Register -->
<div class="footer-links">
  New user?
  <a href="{{ url_for('register_page') }}">Create Account</a>
</div>

</div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<script>

const form = document.getElementById("form");
const toast = document.getElementById("toast");
const loader = document.getElementById("loader");
const btn = document.getElementById("btn");

/* LOGIN */
form.onsubmit = async e => {

  e.preventDefault();

  btn.disabled = true;
  loader.style.display = "block";

  try {

    const r = await fetch("{{ url_for('login_api') }}", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username: user.value.trim(),
        password: pass.value,
        remember: remember.checked
      })
    });

    const d = await r.json();

    if (d.status === "success") {
      showToast("Login successful ‚úî");
      setTimeout(() => {
        location.href = "{{ url_for('home') }}";
      }, 900);
    } else {
      showToast(d.message || "Invalid credentials ‚ùå");
    }

  } catch (err) {
    showToast("Server error ‚ùå");
  }

  btn.disabled = false;
  loader.style.display = "none";
};

/* UTIL */
function showPass(){
  pass.type = pass.type === "password" ? "text" : "password";
}

function forgot(){
  showToast("Please contact administrator");
}

function showToast(text){
  toast.textContent = text;
  toast.style.display = "block";
  setTimeout(() => toast.style.display = "none", 2500);
}

/* VOICE LOGIN */
function voiceLogin(){

  if(!('webkitSpeechRecognition' in window)){
    showToast("Voice login not supported");
    return;
  }

  const rec = new webkitSpeechRecognition();
  rec.start();

  rec.onresult = e => {
    const text = e.results[0][0].transcript.toLowerCase();
    if(text.includes("admin")){
      user.value = "admin";
      pass.focus();
      showToast("Voice detected üé§");
    }
  };
}

</script>

</body>
</html>
